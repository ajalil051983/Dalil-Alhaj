<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:res="clr-namespace:DalilAlHaj.Resources.Localization"
             x:Class="DalilAlHaj.MainPage"
             x:Name="MainContentPage"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*"
          x:Name="MainGrid"
          BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1C1C1E}">
        
        <!-- Custom Header Bar -->
        <Border Grid.Row="0" 
                Background="{AppThemeBinding Light=#2C3E50, Dark=#1E1E1E}" 
                StrokeShape="Rectangle"
                StrokeThickness="0"
                Padding="15,10"
                Stroke="{AppThemeBinding Light=#2C3E50, Dark=#1E1E1E}"
                Margin="0">
            <Grid ColumnDefinitions="Auto,*">
                <!-- Settings Icon on Left -->
                <Button Grid.Column="0"
                        Text="⚙️"
                        FontSize="28"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        Clicked="OnSettingsClicked"
                        Padding="0"
                        WidthRequest="50"
                        HeightRequest="50"
                        VerticalOptions="Center" />
                
                <!-- App title (now visible) -->
                <Label Grid.Column="1"
                       Text="{x:Static res:AppResources.AppTitle}"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       IsVisible="True" />
            </Grid>
        </Border>
        
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="20">
                <!-- Search Bar -->
                <Border x:Name="SearchBarFrame"
                        StrokeShape="RoundRectangle 25"
                        StrokeThickness="0"
                        Background="{AppThemeBinding Light=#FFFFFF, Dark=#2C2C2E}"
                        Padding="5"
                        Margin="0,0,0,0">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.3" Radius="10" Offset="0,2" />
                    </Border.Shadow>
                    <SearchBar x:Name="SearchBar"
                               Placeholder="{x:Static res:AppResources.SearchPrompt}"
                               BackgroundColor="Transparent"
                               SearchButtonPressed="OnSearchBarPressed" />
                </Border>

                <!-- Quick Access Buttons -->
                <Grid ColumnDefinitions="*,*" 
                      ColumnSpacing="10"
                      RowDefinitions="Auto"
                      RowSpacing="10">
                    <Button Grid.Column="0" Grid.Row="0"
                            Clicked="OnMapClicked"
                            BackgroundColor="#E67E22"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="70"
                            FontSize="16"
                            Text="{x:Static res:AppResources.Map}" />
                    <Button Grid.Column="1" Grid.Row="0"
                            x:Name="ChecklistButton"
                            Clicked="OnChecklistClicked"
                            BackgroundColor="#27AE60"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="70"
                            FontSize="16"
                            LineBreakMode="WordWrap" />
                </Grid>

                <!-- Categories Grid (2 columns) -->
                <Label x:Name="ChooseTopicLabel"
                       Text="{x:Static res:AppResources.ChooseTopic}" 
                       FontSize="20" 
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#2C3E50, Dark=#F5F5F5}"
                       Margin="0,10,0,10" />

                <CollectionView x:Name="CategoriesCollection"
                                SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" 
                                         Span="2" 
                                         HorizontalItemSpacing="15"
                                         VerticalItemSpacing="15" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border
                                StrokeShape="RoundRectangle 15"
                                BackgroundColor="{Binding Color}"
                                Padding="0"
                                Margin="0">
                                <Border.Shadow>
                                    <Shadow Brush="Black" Opacity="0.3" Radius="8" Offset="0,2" />
                                </Border.Shadow>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnCategoryTapped"
                                                          CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>
                                <VerticalStackLayout Padding="20"
                                                     Spacing="10"
                                                     HeightRequest="160">
                                    <Label Text="{Binding Icon}"
                                           FontSize="48"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />

                                    <Label Text="{Binding Name}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           TextColor="White"
                                           LineBreakMode="WordWrap" />
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>
