<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:res="clr-namespace:DalilAlHaj.Resources.Localization"
             x:Class="DalilAlHaj.MainPage"
             x:Name="MainContentPage"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*"
          x:Name="MainGrid">
        
        <!-- Custom Header Bar -->
        <Frame Grid.Row="0" 
               BackgroundColor="#2C3E50" 
               CornerRadius="0"
               Padding="15,10"
               HasShadow="True">
            <Grid ColumnDefinitions="Auto,*">
                <!-- Settings Icon on Left -->
                <Button Grid.Column="0"
                        Text="⚙️"
                        FontSize="28"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        Clicked="OnSettingsClicked"
                        Padding="0"
                        WidthRequest="50"
                        HeightRequest="50"
                        VerticalOptions="Center" />
                
                <!-- App title (now visible) -->
                <Label Grid.Column="1"
                       Text="{x:Static res:AppResources.AppTitle}"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       IsVisible="True" />
            </Grid>
        </Frame>
        
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="20">
                <!-- Search Bar -->
                <Frame x:Name="SearchBarFrame"
                       CornerRadius="25"
                       Padding="5"
                       HasShadow="True">
                    <SearchBar x:Name="SearchBar"
                               Placeholder="{x:Static res:AppResources.SearchPrompt}"
                               BackgroundColor="Transparent"
                               SearchButtonPressed="OnSearchBarPressed" />
                </Frame>

                <!-- Quick Access Buttons -->
                <Grid ColumnDefinitions="*,*" 
                      ColumnSpacing="10"
                      RowDefinitions="Auto"
                      RowSpacing="10">
                    <Button Grid.Column="0" Grid.Row="0"
                            Clicked="OnMapClicked"
                            BackgroundColor="#E67E22"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="60"
                            FontSize="16"
                            Text="{x:Static res:AppResources.Map}" />
                    <Button Grid.Column="1" Grid.Row="0"
                            x:Name="ChecklistButton"
                            Clicked="OnChecklistClicked"
                            BackgroundColor="#27AE60"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="70"
                            FontSize="14"
                            LineBreakMode="WordWrap" />
                </Grid>

                <!-- Categories Grid (2 columns) -->
                <Label x:Name="ChooseTopicLabel"
                       Text="{x:Static res:AppResources.ChooseTopic}" 
                       FontSize="20" 
                       FontAttributes="Bold"
                       Margin="0,10,0,10" />

                <CollectionView x:Name="CategoriesCollection"
                                SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" 
                                         Span="2" 
                                         HorizontalItemSpacing="15"
                                         VerticalItemSpacing="15" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="15"
                                   HasShadow="True"
                                   Padding="0"
                                   BackgroundColor="{Binding Color}">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnCategoryTapped" 
                                                          CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>

                                <VerticalStackLayout Padding="20" 
                                                     Spacing="10"
                                                     HeightRequest="160">
                                    <Label Text="{Binding Icon}" 
                                           FontSize="48"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />

                                    <Label Text="{Binding Name}" 
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           TextColor="White"
                                           LineBreakMode="WordWrap" />
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>
